# patchgate policy (MVP)
policy_version = 2

[output]
format = "text"          # text | json
mode = "warn"            # warn | enforce
fail_threshold = 70       # 0..=100, score below this fails in enforce mode

[scope]
mode = "staged"          # staged | worktree | repo
max_changed_files = 10000 # large-diff guardrail
on_exceed = "fail_open"   # fail_open | fail_closed

[cache]
enabled = true
db_path = ".patchgate/cache.db"

[exclude]
# Skip generated files or vendored code
globs = [
  "vendor/**",
]

[generated_code]
mode = "exclude" # exclude | decay
globs = [
  "**/generated/**",
  "**/*.pb.go",
  "**/*_generated.*",
  "**/gen/**",
]
penalty_decay_percent = 70

[language_rules]
rust = true
typescript = true
python = true
go = true
java_kotlin = false # opt-in

[weights]
test_gap_max_penalty = 35
dangerous_change_max_penalty = 45
dependency_update_max_penalty = 30

[test_gap]
enabled = true
test_globs = [
  "tests/**",
  "**/__tests__/**",
  "**/*.test.*",
  "**/*.spec.*",
  "**/*_test.go",
  "**/test_*.py",
]
production_ignore_globs = [
  "docs/**",
  "**/*.md",
  "**/*.txt",
  "**/*.rst",
  "**/*.adoc",
]
missing_tests_penalty = 28
large_change_lines = 200
large_change_penalty = 8

[dangerous_change]
enabled = true
# patterns: high-risk paths (base penalty)
patterns = [
  ".github/workflows/**",
  "infra/**",
  "terraform/**",
  "k8s/**",
  "helm/**",
  "migrations/**",
  "db/migrate/**",
  "**/auth/**",
  "**/security/**",
  "Dockerfile",
  "docker-compose*.yml",
  "docker-compose*.yaml",
]
# critical_patterns: subset of patterns that receive extra critical bonus penalty
critical_patterns = [
  ".github/workflows/**",
  "infra/**",
  "terraform/**",
  "k8s/**",
  "migrations/**",
]
per_file_penalty = 10
critical_bonus_penalty = 6

[dependency_update]
enabled = true
# manifest_globs: direct dependency declarations
manifest_globs = [
  "**/Cargo.toml",
  "**/package.json",
  "**/go.mod",
  "**/requirements*.txt",
  "**/pyproject.toml",
  "**/Gemfile",
  "**/pom.xml",
  "**/build.gradle",
  "**/build.gradle.kts",
]
# lockfile_globs: resolved dependency graph snapshots
lockfile_globs = [
  "**/Cargo.lock",
  "**/package-lock.json",
  "**/yarn.lock",
  "**/pnpm-lock.yaml",
  "**/go.sum",
  "**/Pipfile.lock",
  "**/poetry.lock",
  "**/Gemfile.lock",
]
manifest_penalty = 18
lockfile_penalty = 8
large_lockfile_churn = 200
large_lockfile_penalty = 10
lockfile_added_or_removed_penalty = 6
lockfile_mass_update_lines = 800
lockfile_mass_update_penalty = 6

[dependency_update.ecosystem_penalties.cargo]
manifest_bonus_penalty = 3
lockfile_bonus_penalty = 2
large_lockfile_bonus_penalty = 2

[dependency_update.ecosystem_penalties.npm]
manifest_bonus_penalty = 3
lockfile_bonus_penalty = 2
large_lockfile_bonus_penalty = 3

[dependency_update.ecosystem_penalties.python]
manifest_bonus_penalty = 2
lockfile_bonus_penalty = 1
large_lockfile_bonus_penalty = 2

[dependency_update.ecosystem_penalties.go]
manifest_bonus_penalty = 2
lockfile_bonus_penalty = 2
large_lockfile_bonus_penalty = 1

[dependency_update.ecosystem_penalties.jvm]
manifest_bonus_penalty = 2
lockfile_bonus_penalty = 0
large_lockfile_bonus_penalty = 0
